<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tizen IPTV Player</title>
    
    <!-- 1. Tailwind CSS for lightweight, utility-first styling -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 
      2. Tizen WebAPI Script
      This will only load on a real Tizen device.
    -->
    <script src="$WEBAPIS/webapis/webapis.js"></script>

    <!-- 3. Custom App Stylesheet -->
    <link rel="stylesheet" href="style.css">

</head>
<body class="theme-default">

    <!-- 4. App Container -->
    <div id="app-container" class="w-full h-screen">

        <!-- ===== Global Header ===== -->
        <div id="global-header" class="fixed top-0 left-0 right-0 h-16 bg-alt flex items-center justify-between px-4 z-20 shadow">
            <!-- Left Slot: Back Button -->
            <div class="w-1/3">
                <button id="global-back-button" onclick="goBack()" class="nav-item-sm p-2 rounded-full hover:bg-card hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                </button>
            </div>
            
            <!-- Center Slot: Time / Title -->
            <div class="w-1/3 text-center">
                <h2 id="global-header-title" class="text-2xl font-bold text-main hidden truncate">Page Title</h2>
            </div>

            <!-- Right Slot: Settings -->
            <div class="w-1/3 flex justify-end">
                <div id="virtualization-position" class="font-semibold text-main" >--:--</div>
                <div id="current-time" class="font-semibold text-main" >--:--</div>

                <button onclick="showSettingsPage()" class="nav-item-sm p-2 bg-card rounded-full focus:outline-none">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-main" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826 3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                </button>
            </div>
        </div>

        <!-- ===== PAGE: USER LOGIN ===== -->
        <div id="page-user-login" class="page flex items-center justify-center p-4">
            <div class="w-full max-w-md p-8 space-y-6 rounded-lg shadow bg-alt" style="margin: 10% auto auto;">
                <h1 class="text-3xl font-bold text-center text-main">IPTV Player</h1>
                <p class="text-center text-alt">Enter your username to load profile</p>
                <div class="space-y-4">
                    <div>
                        <label for="username" class="block mb-2 text-sm font-medium text-alt">Username</label>
                        <input type="text" id="username" placeholder="e.g. 'family' or 'john'" class="nav-item w-full p-3 rounded-lg bg-card text-main border border-transparent focus:outline-none focus:ring-2 ring-primary">
                    </div>
                    <button id="user-login-button" class="w-full p-3 font-bold rounded-lg bg-primary text-white hover:bg-primary-hover transition-colors nav-item">
                        Login / Create
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ===== PAGE: API DETAILS (was LOGIN) ===== -->
        <div id="page-api-details" class="page flex items-center justify-center p-10 pt-20">
            <div class="w-full max-w-md p-8 space-y-6 rounded-lg shadow bg-alt">
                <h1 class="text-3xl font-bold text-center text-main">Connect API</h1>
                <p class="text-center text-alt">Enter your Xtream Codes API details for user <b id="api-username" class="text-primary"></b></p>
                <div class="space-y-4">
                    <div>
                        <label for="host" class="block mb-2 text-sm font-medium text-alt">Server URL (http://...:port)</label>
                        <input type="text" id="host" placeholder="http://mydomain.com:8080" class="nav-item w-full p-3 rounded-lg bg-card text-main border border-transparent focus:outline-none focus:ring-2 ring-primary">
                    </div>
                    <div>
                        <label for="api-user" class="block mb-2 text-sm font-medium text-alt">API Username</label>
                        <input type="text" id="api-user" placeholder="your_username" class="nav-item w-full p-3 rounded-lg bg-card text-main border border-transparent focus:outline-none focus:ring-2 ring-primary">
                    </div>
                    <div>
                        <label for="api-pass" class="block mb-2 text-sm font-medium text-alt">API Password</label>
                        <input type="password" id="api-pass" placeholder="your_password" class="nav-item w-full p-3 rounded-lg bg-card text-main border border-transparent focus:outline-none focus:ring-2 ring-primary">
                    </div>
                    <button id="api-connect-button" class="w-full p-3 font-bold rounded-lg bg-primary text-white hover:bg-primary-hover transition-colors nav-item">
                        Connect
                    </button>
                </div>
            </div>
        </div>

        <!-- ===== PAGE: MAIN MENU ===== -->
        <div id="page-main" class="page flex items-center justify-center  p-10 pt-20">
            <div style="height: 32%;"></div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full max-w-4xl" style="margin: auto;">
                <button onclick="loadCategories('live')" class="nav-item flex flex-col items-center justify-center p-12 rounded-lg shadow bg-card hover:bg-opacity-80 transition-all h-48">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M4 5h8a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V7a2 2 0 012-2z" /></svg>
                    <span class="mt-4 text-2xl font-bold text-main">Live TV</span>
                </button>
                <button onclick="loadCategories('vod')" class="nav-item flex flex-col items-center justify-center p-12 rounded-lg shadow bg-card hover:bg-opacity-80 transition-all h-48">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z" /></svg>
                    <span class="mt-4 text-2xl font-bold text-main">Movies</span>
                </button>
                <button onclick="loadCategories('series')" class="nav-item flex flex-col items-center justify-center p-12 rounded-lg shadow bg-card hover:bg-opacity-80 transition-all h-48">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg>
                    <span class="mt-4 text-2xl font-bold text-main">Series</span>
                </button>
            </div>
        </div>

        <!-- ===== PAGE: CATEGORIES ===== -->
        <div id="page-categories" class="page page-with-padding  p-10 pt-20">
            <div id="category-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-4 gap-4 p-4">
                <!-- Categories will be injected here -->
            </div>
        </div>

        <!-- ===== PAGE: CONTENT (MOVIES/SERIES) ===== -->
        <!-- 
          This page is the container for the virtual list.
          The virtual list code will take it over.
          The #content-grid inside it will be the *scrolling container*.
        -->
        <div id="page-content" class="page page-with-padding  p-10 pt-20" style="width:1300px;">
            <!-- 
                This grid will either be filled with regular cards
                OR it will become the container for the virtual list.
            -->
            <div id="content-grid" style="    overflow-y: auto;position: relative;">
                <!-- Movie/Series posters will be injected here -->
            </div>
        </div>
        
        <!-- ===== PAGE: SERIES DETAILS (NEW) ===== -->
        <div id="page-series-details" class="page  page-with-padding  p-10 pt-20">
            <div class="flex flex-col md:flex-row gap-8  md:p-8">
                <!-- Left Column: Info -->
                <div class="w-full md:w-1/3 lg:w-1/4 flex-shrink-0">
                    <img id="series-cover-image" src="" alt="Series Cover" class="w-full rounded-lg shadow object-cover aspect-[2/3]">
                    <h1 id="series-title" class="text-3xl font-bold text-main mt-4">Series Title</h1>
                    <div class="flex items-center gap-4 mt-2">
                        <p id="series-year" class="text-lg text-alt">Year</p>
                        <!-- FAVORITE BUTTON -->
                        <button id="series-fav-button" class="nav-item-sm p-2 rounded-full bg-card text-main">
                            <!-- Heart icon will be injected by JS -->
                        </button>
                        <!-- NEW WATCH LATER BUTTON -->
                        <button id="series-watch-later-button" class="nav-item-sm p-2 rounded-full bg-card text-main">
                            <!-- Bookmark icon will be injected by JS -->
                        </button>
                    </div>
                    <p id="series-plot" class="text-sm text-alt mt-4">Plot description will load here...</p>
                </div>
                
                <!-- Right Column: Seasons & Episodes -->
                <div class="w-full md:w-2/3 lg:w-3/4">
                    <!-- Season Tabs -->
                    <div id="series-seasons-tabs" class="flex flex-wrap gap-2 p-2 bg-card rounded-lg mb-4">
                        <!-- Season tabs injected here -->
                    </div>
                    
                    <!-- Episodes List -->
                    <div id="series-episodes-list" class="flex flex-col gap-2 max-h-[60vh] overflow-y-auto pr-2">
                        <!-- Episodes injected here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ===== PAGE: SETTINGS ===== -->
        <div id="page-settings" class=" page pagepage-with-padding  p-10 pt-20" style="display: none;">
            <div class="p-4 max-w-2xl mx-auto space-y-6">
                <!-- Theme Settings -->
                <div>
                    <h3 class="text-xl font-semibold mb-2 text-main">Change Theme</h3>
                    <div class="flex gap-2 p-2 bg-card rounded-full w-max">
                        <button onclick="setTheme('theme-default')" class="nav-item-sm w-8 h-8 bg-blue-500 rounded-full focus:outline-none border-2 border-transparent"></button>
                        <button onclick="setTheme('theme-red')" class="nav-item-sm w-8 h-8 bg-red-500 rounded-full focus:outline-none border-2 border-transparent"></button>
                        <button onclick="setTheme('theme-green')" class="nav-item-sm w-8 h-8 bg-green-500 rounded-full focus:outline-none border-2 border-transparent"></button>
                        <button onclick="setTheme('theme-purple')" class="nav-item-sm w-8 h-8 bg-purple-500 rounded-full focus:outline-none border-2 border-transparent"></button>
                        <button onclick="setTheme('theme-orange')" class="nav-item-sm w-8 h-8 bg-orange-500 rounded-full focus:outline-none border-2 border-transparent"></button>
                    </div>
                </div>
                
                <!-- Account Settings -->
                <div>
                    <h3 class="text-xl font-semibold mb-2 text-main">Account</h3>
                    <button id="logout-button" class="nav-item p-3 font-bold rounded-lg bg-red-600 text-white hover:bg-red-700 transition-colors w-full sm:w-auto">
                        Logout (User: <span id="setting-username"></span>)
                    </button>
                </div>

                <!-- API Settings -->
                <div>
                    <h3 class="text-xl font-semibold mb-2 text-main">API Settings</h3>
                    <button id="change-api-button" class="nav-item p-3 font-bold rounded-lg bg-card text-main hover:bg-opacity-80 transition-colors w-full sm:w-auto">
                        Change Xtream API
                    </button>
                </div>
                
                <!-- Cache Settings -->
                <div>
                    <h3 class="text-xl font-semibold mb-2 text-main">Clear Cache</h3>
                    <div class="flex flex-col sm:flex-row gap-4">
                         <button id="clear-favorites-button" class="nav-item p-3 font-bold rounded-lg bg-card text-main hover:bg-opacity-80 transition-colors">
                            Clear All Favorites
                        </button>
                        <button id="clear-watched-button" class="nav-item p-3 font-bold rounded-lg bg-card text-main hover:bg-opacity-80 transition-colors">
                            Clear Watched Progress
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== PAGE: PLAYER ===== -->
        <div id="page-player" class="page">
            <!-- 1. Standard HTML5 Web Player -->
            <video id="web-video-player" controls class="hidden w-full h-full"></video>

            <!-- 2. Tizen AVPlay Container -->
            <div id="tizen-player-container" class="hidden"></div>
            
            <!-- 3. Tizen Player Overlay (This is the one being used) -->
            <div id="tizen-player-overlay" class="hidden absolute inset-0 p-8 text-white text-lg flex flex-col justify-between opacity-0 transition-opacity duration-300 z-10">
                
                <!-- Top Bar: Title, Rating, Time -->
                <div class="flex justify-between items-start bg-gradient-to-b from-black/70 -m-8 p-8 pb-16">
                    <div>
                        <h3 id="tizen-movie-name" class="text-3xl font-bold">Movie Name</h3>
                        <p id="tizen-movie-rating" class="text-xl text-yellow-400">Rating: 9.0</p>
                    </div>
                    <div id="tizen-current-time" class="text-2xl font-semibold">--:--</div>
                </div>

                <!-- Bottom Bar: Progress, Controls, Info -->
                <div class="flex flex-col gap-4 bg-gradient-to-t from-black/70 -m-8 p-8 pt-16">
                    <!-- Progress Bar -->
                    <div class="flex items-center gap-4">
                        <span id="tizen-progress-time" class="text-lg">00:00</span>
                        <div id="tizen-progress-bar" tabindex="0" class="nav-item flex-1 h-3 bg-gray-600 rounded-full cursor-pointer relative">
                            <div id="tizen-progress-fill" class="h-full bg-primary rounded-full" style="width: 0%;"></div>
                            <div id="tizen-progress-thumb" class="w-5 h-5 bg-white rounded-full absolute top-1/2 -translate-y-1/2 -ml-2.5 hidden" style="left: 0%;"></div>
                        </div>
                        <span id="tizen-progress-duration" class="text-lg">00:00</span>
                    </div>

                    <!-- Controls Row -->
                    <div class="flex justify-between items-center">
                        <!-- Left Controls: Subtitle, Audio -->
                        <div class="flex gap-4">
                            <button id="tizen-subtitle-button" class="nav-item p-3 rounded-full bg-black/30 hover:bg-card">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8M8 12h8M9 16h6" /></svg>
                            </button>
                            <button id="tizen-audio-button" class="nav-item p-3 rounded-full bg-black/30 hover:bg-card">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072M17.657 6.343a8 8 0 010 11.314M19.778 4.222a11 11 0 010 15.556M3 10v4a2 2 0 002 2h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2zm11-1a1 1 0 011-1h1a1 1 0 110 2h-1a1 1 0 01-1-1z" /></svg>
                            </button>
                        </div>

                        <!-- Center Controls: Play/Pause -->
                        <button id="tizen-play-pause-button" class="nav-item p-4 rounded-full bg-primary hover:bg-primary-hover">
                            <svg id="tizen-play-icon" xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 hidden" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" /></svg>
                            <svg id="tizen-pause-icon" xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 011-1h1a1 1 0 110 2H8a1 1 0 01-1-1zm5 0a1 1 0 011-1h1a1 1 0 110 2h-1a1 1 0 01-1-1z" clip-rule="evenodd" /></svg>
                        </button>

                        <!-- Right Info: Status, Resolution, Quality -->
                        <div class="flex items-center gap-4 text-sm text-alt">
                            <span id="tizen-stream-status" class="font-semibold">Buffering</span>
                            <span id="tizen-stream-resolution">--x--</span>
                            <span id="tizen-stream-quality-tag" class="px-2 py-0.5 bg-gray-800 text-white rounded font-bold">FHD</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- ===== Global Overlays ===== -->
    <div id="loading-overlay" class="hidden fixed inset-0 z-50 bg-black/50 flex items-center justify-center">
        <div class="loader"></div>
    </div>
    
    <div id="error-toast" class="hidden fixed bottom-5 left-1/2 -translate-x-1/2 z-50 p-4 rounded-lg shadow bg-red-600 text-white">
        An error occurred. Please try again.
    </div>

    <div id="alert-toast" class="hidden fixed bottom-5 left-1/2 -translate-x-1/2 z-50 p-4 rounded-lg shadow bg-zinc-800 text-white">
    </div>

    <!-- Movie Details Modal -->
    <div id="movie-details-modal" class="hidden fixed inset-0 z-40 bg-black/60 flex items-center justify-center p-4">
        <div class="bg-card w-full max-w-3xl rounded-lg shadow overflow-hidden flex flex-col md:flex-row">
            <!-- Poster -->
            <img id="modal-movie-poster" src="" class="w-full md:w-1/3 h-64 md:h-auto object-cover" alt="Movie Poster">
            <!-- Details -->
            <div class="flex-1 p-6 space-y-4 overflow-y-auto" style="max-height: 80vh;">
                <h2 id="modal-movie-title" class="text-3xl font-bold text-main">Movie Title</h2>
                <div class="flex flex-wrap items-center gap-4 text-alt">
                    <span id="modal-movie-year">2023</span>
                    <span id="modal-movie-duration">120 min</span>
                    <span class="flex items-center gap-1 text-yellow-400">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                        <span id="modal-movie-rating-text">8.5</span>
                    </span>
                </div>
                <p id="modal-movie-plot" class="text-main">Plot summary goes here...</p>
                <p class="text-sm text-alt"><strong>Cast:</strong> <span id="modal-movie-cast">Actor 1, Actor 2</span></p>
                <p class="text-sm text-alt"><strong>Genre:</strong> <span id="modal-movie-genre">Action, Sci-Fi</span></p>
                
                <!-- Action Buttons -->
                <div class="flex gap-4 pt-4">
                    <button id="modal-play-button" class="nav-item p-3 px-6 font-bold rounded-lg bg-primary text-white hover:bg-primary-hover transition-colors">
                        Play
                    </button>
                    <button id="modal-close-button" class="nav-item p-3 px-6 font-bold rounded-lg bg-alt text-main hover:bg-opacity-80 transition-colors">
                        Close
                    </button>

                    <!-- FAVORITE BUTTON -->
                    <button id="modal-fav-button" class="nav-item-sm p-3 rounded-full bg-alt text-main hover:bg-opacity-80 transition-colors">
                        <!-- Heart icon will be injected by JS -->
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tizen Player Track Modals (NEW) -->
    <div id="tizen-track-modal" class="hidden fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4">
        <div class="bg-card w-full max-w-md rounded-lg shadow-xl overflow-hidden">
            <h2 id="tizen-track-modal-title" class="text-2xl font-bold text-main p-4 bg-alt">Select Track</h2>
            <div id="tizen-track-modal-list" class="flex flex-col gap-1 p-2 max-h-[60vh] overflow-y-auto">
                <!-- Tracks will be injected here -->
            </div>
            <div class="p-4 bg-alt">
                <button id="tizen-track-modal-close" class="nav-item p-3 px-6 font-bold rounded-lg bg-alt text-main hover:bg-opacity-80 border-2 border-gray-600">
                    Close
                </button>
            </div>
        </div>
    </div>


    <!-- 1. Global state variables (must be first) -->
    <script src="js/00-state.js"></script>
    
    <!-- 2. Virtualization logic (defines its own state) -->
    <script src="js/01-virtualization.js"></script>
    
    <!-- 3. Core utilities (DOM helpers, etc.) -->
    <script src="js/02-utils.js"></script>
    
    <!-- 4. Other UI logic (theming, clock, modals) -->
    <script src="js/03-ui.js"></script>
    
    <!-- 5. Navigation and Routing logic -->
    <script src="js/04-routing.js"></script>
    
    <!-- 6. API fetching logic -->
    <script src="js/05-api.js"></script>
    
    <!-- 7. User management (login, settings) -->
    <script src="js/06-user.js"></script>
    
    <!-- 8. User data logic (favorites, watched) -->
    <script src="js/07-data.js"></script>
    
    <!-- 9. Player logic (web and tizen) -->
    <script src="js/08-player.js"></script>
    
    <!-- 10. Content loading logic (categories, movies) -->
    <script src="js/09-content.js"></script>
    
    <!-- 11. Main app entry point (event listeners) -->
    <script src="js/10-main.js"></script>

    <!-- 12. REMOVED: 08-player-overlay.js was here, but it was unused -->
</body>
</html>